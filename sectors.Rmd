---
title: "Sector Performance"
---

```{r, include=FALSE}
rm(list=ls())
library(readr)
library(RSQLite)
suppressMessages(library(ggplot2))
suppressMessages(library(tidyverse))
suppressMessages(library(lubridate))

# Get the ETF prices from the database.
con <- dbConnect(SQLite(), dbname="/data/db")
prices <- dbGetQuery(con, "select * from fse;")
dbDisconnect(con)

prices <- data.frame(prices) %>%
   mutate(date = as.Date(date)) %>%
   select(ticker, date, adjusted) %>%
   filter(date >= "2017-01-01") %>%
   group_by(ticker) %>%
   mutate(price = adjusted / first(adjusted))

pp <- prices %>% mutate(ticker = substr(ticker, 2, 10))
```

```{r, echo=FALSE}
ggplot(pp, aes(x=date, y=price, col=ticker)) + geom_line()
```

```{R, include=FALSE}
P <- prices %>% select(date, ticker, price) %>%
   pivot_wider(names_from=ticker, values_from=price)

currdate <- P %>% slice(n()) %>% pull(date)
currprc  <- P %>% slice(n()) %>% select(starts_with("F"))
previous <- currdate - months(c(1, 3, 6, 12, 24, 36), abbreviate=F)
ndx <- rep(NA, length(previous))
R   <- NULL
for (k in 1:length(previous)) {
   i <- min(which.min(abs(P$date - previous[k])))
   p <- P[i,] %>% select(starts_with("F"))
   r <- currprc / p - 1
   R <- rbind(R, r)
}

rownames(R) <- c("one month",
                 "three months",
                 "six months",
                 "one year",
                 "two years",
                 "three years")
R <- round(100 * R, 1)

colnames(R) <- substr(colnames(R), 2, 10)
```

| Abbreviation  | Sector                  |
|---------------|-------------------------|
| ENY           | Energy                  |
| MAT           | Materials               |
| IDU           | Industrials             |
| UTY           | Utilities               |
| HLC           | Health Care             |
| NCL           | Financials              |
| DIS           | Consumer Discretionary  |
| STA           | Consumer Staples        |
| TEC           | Information Technology  |
| COM           | Communication Services  |
| REL           | Real Estate             |

```{r, echo=FALSE, results='asis'}
library(knitr)
kable(t(R), caption="Performance of Market Sectors")
```

